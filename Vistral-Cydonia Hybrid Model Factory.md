# Vistral-Cydonia Hybrid Model Factory

Этот репозиторий содержит полный конвейер (pipeline) для создания гибридной Large Language Model, объединяющей сильные стороны двух моделей:

*   **`Vikhrmodels/Vistral-24B-Instruct`**: Глубокое знание русского языка.
*   **`TheDrummer/Cydonia-24B-v4.2.0`**: Превосходные способности к Role-Playing (RP) и следованию сложным инструкциям.

Процесс использует State-of-the-Art (SOTA) техники для достижения наилучшего результата.

## Философия подхода (3 Фазы)

1.  **Фаза 1: Гибридное слияние (`DARE TIES`)**. Мы не просто смешиваем модели. Мы вычисляем "умения" каждой из них (разницу с общей базовой моделью) и складываем их. Для несовместимых слоев словаря используется "хирургический" метод `SLERP`.
2.  **Фаза 2: "Полировка" (`LoRA` + `CAME`)**. После слияния модель может иметь внутренние несогласованности ("швы"). Мы проводим короткое дообучение (1 эпоха) на русскоязычном датасете `GrandMaster2` с помощью LoRA. Используется продвинутый оптимизатор `CAME`, который исправляет ошибки, не разрушая уже имеющиеся знания.
3.  **Фаза 3: Финализация**. Мы "впекаем" LoRA-адаптер в модель, чтобы получить единый, готовый к использованию файл.

## Требования

*   Аккаунт [RunPod](https://runpod.io).
*   Аккаунт [Hugging Face](https://huggingface.co).
*   Токен доступа Hugging Face с правами на **запись (`write`)**.
*   **Рекомендуемый Под:** GPU `NVIDIA RTX A6000 (48 GB VRAM)` или мощнее.
*   **Дисковое пространство:** **250 GB** или больше.

## Как использовать

1.  **Запустите Под** на RunPod с шаблоном `RunPod Pytorch 2.2.1` (или новее).

2.  **Подключитесь к терминалу** и клонируйте этот репозиторий:
    ```bash
    git clone https://github.com/YourUsername/YourRepoName.git
    cd YourRepoName
    ```

3.  **Установите все зависимости** с помощью скрипта установки:
    ```bash
    chmod +x setup.sh
    ./setup.sh
    ```

4.  **Установите переменные окружения.** **Не вписывайте токен прямо в скрипт!**
    ```bash
    export HF_USERNAME="ваш-логин-на-hf"
    export HF_TOKEN="hf_ВАШ_ТОКЕН_С_ПРАВАМИ_ЗАПИСИ"
    export NEW_MODEL_NAME="Vistral-Cydonia-Final-24B" # Или любое другое имя для вашей модели
    ```

5.  **Запустите конвейер пофазово.** Каждый скрипт выполняет один большой шаг и подготавливает все для следующего.

    **Фаза 1: Слияние моделей**
    ```bash
    chmod +x scripts/01_run_merge.sh
    ./scripts/01_run_merge.sh
    ```
    *(...идите пить чай, это надолго...)*

    **Фаза 2: Полировка LoRA**
    ```bash
    chmod +x scripts/02_run_finetune.sh
    ./scripts/02_run_finetune.sh
    ```
    *(...еще один чай...)*

    **Фаза 3: Финализация и загрузка**
    ```bash
    chmod +x scripts/03_run_finalize.sh
    ./scripts/03_run_finalize.sh
    ```

6.  **Готово!** После успешного выполнения последнего скрипта, ваша новая модель будет в вашем репозитории на Hugging Face.

7.  **!!! НЕ ЗАБУДЬТЕ ОСТАНОВИТЬ ПОД НА RUNPOD !!!**